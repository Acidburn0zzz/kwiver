project(sprokit_test_pipeline_util)

set(test_libraries
  sprokit_pipeline_util
  sprokit_pipeline
  ${Boost_FILESYSTEM_LIBRARY}
  ${Boost_SYSTEM_LIBRARY})

set(sprokit_test_pipelines_directory
  "${sprokit_test_data_directory}/pipelines")

function (sprokit_add_tooled_load_test name instance)
  sprokit_add_tooled_test(${name} ${instance}
    "${sprokit_test_pipelines_directory}")
endfunction ()

##############################
# Pipeline loading tests
##############################
sprokit_build_tooled_test(load_pipe test_libraries test_load_pipe.cxx)

sprokit_add_tooled_load_test(load_pipe empty)
sprokit_add_tooled_load_test(load_pipe comments)
sprokit_add_tooled_load_test(load_pipe empty_config)
sprokit_add_tooled_load_test(load_pipe config_block)
sprokit_add_tooled_load_test(load_pipe config_block_notalnum)
sprokit_add_tooled_load_test(load_pipe config_value_spaces)
sprokit_add_tooled_load_test(load_pipe one_process)
sprokit_add_tooled_load_test(load_pipe connected_processes)
sprokit_add_tooled_load_test(load_pipe connected_processes_notalnum)
sprokit_add_tooled_load_test(load_pipe include)
sprokit_add_tooled_load_test(load_pipe no_exist)
sprokit_add_tooled_load_test(load_pipe not_a_file)
sprokit_add_tooled_load_test(load_pipe include_no_exist)
sprokit_add_tooled_load_test(load_pipe include_not_a_file)
sprokit_add_tooled_load_test(load_pipe no_parse)
sprokit_add_tooled_load_test(load_pipe parse_error)
set(sprokit_test_environment "SPROKIT_PIPE_INCLUDE_PATH=${CMAKE_CURRENT_SOURCE_DIR}")
sprokit_add_tooled_load_test(load_pipe envvar)
unset(sprokit_test_environment)
sprokit_add_tooled_load_test(load_pipe cluster_declare)
sprokit_add_tooled_load_test(load_pipe cluster_config)
sprokit_add_tooled_load_test(load_pipe cluster_input_map)
sprokit_add_tooled_load_test(load_pipe cluster_input_multi_map)
sprokit_add_tooled_load_test(load_pipe cluster_output_map)
sprokit_add_tooled_load_test(load_pipe cluster_mappings)
sprokit_add_tooled_load_test(load_pipe cluster_all)
sprokit_add_tooled_load_test(load_pipe cluster_missing_config_description)
sprokit_add_tooled_load_test(load_pipe cluster_missing_input_description)
sprokit_add_tooled_load_test(load_pipe cluster_missing_output_description)
sprokit_add_tooled_load_test(load_pipe cluster_missing_type)
sprokit_add_tooled_load_test(load_pipe cluster_missing_type_description)
sprokit_add_tooled_load_test(load_pipe cluster_multiple_clusters)
sprokit_add_tooled_load_test(load_pipe cluster_not_first)
sprokit_add_tooled_load_test(load_pipe cluster_with_slash)
sprokit_add_tooled_load_test(load_pipe cluster_input_map_with_slash)
sprokit_add_tooled_load_test(load_pipe cluster_output_map_with_slash)
sprokit_add_tooled_load_test(load_pipe process_with_slash)
sprokit_add_tooled_load_test(load_pipe connect_input_with_slash)
sprokit_add_tooled_load_test(load_pipe connect_output_with_slash)

##############################
# Baking tests
##############################
sprokit_build_tooled_test(pipe_bakery test_libraries test_pipe_bakery.cxx)

sprokit_add_tooled_load_test(pipe_bakery config_block)
sprokit_add_tooled_load_test(pipe_bakery config_block_notalnum)
sprokit_add_tooled_load_test(pipe_bakery config_value_spaces)
sprokit_add_tooled_load_test(pipe_bakery config_overrides)
sprokit_add_tooled_load_test(pipe_bakery config_read_only)
sprokit_add_tooled_load_test(pipe_bakery config_not_a_flag)
sprokit_add_tooled_load_test(pipe_bakery config_read_only_override)
sprokit_add_tooled_load_test(pipe_bakery config_append)
sprokit_add_tooled_load_test(pipe_bakery config_append_ro)
sprokit_add_tooled_load_test(pipe_bakery config_append_provided)
sprokit_add_tooled_load_test(pipe_bakery config_append_provided_ro)
sprokit_add_tooled_load_test(pipe_bakery config_append_comma)
sprokit_add_tooled_load_test(pipe_bakery config_append_comma_empty)
sprokit_add_tooled_load_test(pipe_bakery config_append_space)
sprokit_add_tooled_load_test(pipe_bakery config_append_space_empty)
sprokit_add_tooled_load_test(pipe_bakery config_append_path)
sprokit_add_tooled_load_test(pipe_bakery config_append_path_empty)
sprokit_add_tooled_load_test(pipe_bakery config_append_flag_mismatch_ac)
sprokit_add_tooled_load_test(pipe_bakery config_append_flag_mismatch_ap)
sprokit_add_tooled_load_test(pipe_bakery config_append_flag_mismatch_cp)
sprokit_add_tooled_load_test(pipe_bakery config_append_flag_mismatch_all)
sprokit_add_tooled_load_test(pipe_bakery config_provider_conf)
sprokit_add_tooled_load_test(pipe_bakery config_provider_conf_dep)
sprokit_add_tooled_load_test(pipe_bakery config_provider_conf_circular_dep)
set(sprokit_test_environment "TEST_ENV=expected")
sprokit_add_tooled_load_test(pipe_bakery config_provider_env)
unset(sprokit_test_environment)
sprokit_add_tooled_load_test(pipe_bakery config_provider_read_only)
sprokit_add_tooled_load_test(pipe_bakery config_provider_read_only_override)
sprokit_add_tooled_load_test(pipe_bakery config_provider_unprovided)
sprokit_add_tooled_load_test(pipe_bakery pipeline_multiplier)
sprokit_add_tooled_load_test(pipe_bakery cluster_multiplier)
sprokit_add_tooled_load_test(pipe_bakery cluster_missing_cluster)
sprokit_add_tooled_load_test(pipe_bakery cluster_missing_processes)
sprokit_add_tooled_load_test(pipe_bakery cluster_missing_ports)
sprokit_add_tooled_load_test(pipe_bakery cluster_multiple_cluster)
sprokit_add_tooled_load_test(pipe_bakery cluster_duplicate_input)
sprokit_add_tooled_load_test(pipe_bakery cluster_duplicate_output)
sprokit_add_tooled_load_test(pipe_bakery cluster_configuration_default)
sprokit_add_tooled_load_test(pipe_bakery cluster_configuration_provide)
sprokit_add_tooled_load_test(pipe_bakery cluster_map_config)
sprokit_add_tooled_load_test(pipe_bakery cluster_map_config_tunable)
sprokit_add_tooled_load_test(pipe_bakery cluster_map_config_redirect)
sprokit_add_tooled_load_test(pipe_bakery cluster_map_config_modified)
sprokit_add_tooled_load_test(pipe_bakery cluster_map_config_not_read_only)
sprokit_add_tooled_load_test(pipe_bakery cluster_map_config_only_provided)
set(sprokit_test_environment "TEST_ENV=expected")
sprokit_add_tooled_load_test(pipe_bakery cluster_map_config_only_conf_provided)
unset(sprokit_test_environment)
sprokit_add_tooled_load_test(pipe_bakery cluster_map_config_to_non_process)
sprokit_add_tooled_load_test(pipe_bakery cluster_map_config_not_from_cluster)
sprokit_add_tooled_load_test(pipe_bakery cluster_override_mapped)

##############################
# Export tests
##############################
sprokit_build_tooled_test(export_dot test_libraries test_export_dot.cxx)

sprokit_add_tooled_load_test(export_dot pipeline_null)
sprokit_add_tooled_load_test(export_dot pipeline_empty_name)
sprokit_add_tooled_load_test(export_dot simple_pipeline)
sprokit_add_tooled_load_test(export_dot simple_pipeline_setup)
sprokit_add_tooled_load_test(export_dot simple_pipeline_cluster)
sprokit_add_tooled_load_test(export_dot cluster_null)
sprokit_add_tooled_load_test(export_dot cluster_empty_name)
sprokit_add_tooled_load_test(export_dot cluster_multiplier)
